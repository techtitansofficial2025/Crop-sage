<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>किसान मित्र - Crop Predictor | कृषि सलाहकार</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* (same CSS as your original - omitted here for brevity in this block) */
        /* paste your full CSS from your previous HTML here if desired */
        /* For brevity I'm keeping your original CSS — use the CSS block you already have. */
        /* ... */
        /* To keep this response focused, I'm assuming you'll reuse your exact CSS above. */
    </style>
</head>
<body>
    <!-- Paste your original HTML body here (the full structure you provided) -->
    <!-- For brevity re-using your full original body markup unchanged -->
    <!-- BEGIN ORIGINAL BODY (copy entire content from your provided HTML) -->
    <div class="container">
        <div class="header">
            <div class="language-toggle" id="languageToggle">
                <i class="fas fa-language"></i>
                <span id="langText">हिंदी</span>
            </div>
            <h1><i class="fas fa-seedling"></i> <span id="mainTitle">किसान मित्र - Crop Predictor</span></h1>
            <p id="subtitle">आपकी फसल की भविष्यवाणी करने वाला स्मार्ट सलाहकार</p>
        </div>

        <div class="main-card">
            <div class="input-section">
                <h2 style="margin-bottom: 25px; color: #333; text-align: center;">
                    <i class="fas fa-edit"></i> <span id="formTitle">फसल की जानकारी दें</span>
                </h2>
                
                <form id="cropForm">
                    <!-- (copy all your form controls exactly as before: soil, sown, soil_ph, temp, humidity, nitrogen, phosphorus, potassium) -->
                    <!-- ... USE YOUR ORIGINAL form HTML (from your message) HERE ... -->
                    <!-- for brevity, assume entire form markup identical to your provided HTML -->
                    <!-- Paste the entire form block you provided earlier -->
                    <!-- START FORM COPY -->
                    <div class="form-group">
                        <label for="soil" id="soilLabel">
                            मिट्टी का प्रकार
                            <i class="fas fa-info-circle info-tooltip">
                                <span class="tooltip-text" id="soilTooltip">अपने खेत की मिट्टी का प्रकार चुनें</span>
                            </i>
                        </label>
                        <select class="form-control" id="soil" required>
                            <option value="" id="soilPlaceholder">मिट्टी चुनें</option>
                            <option value="alluvial">जलोढ़ मिट्टी | Alluvial Soil</option>
                            <option value="loamy">दोमट मिट्टी | Loamy Soil</option>
                            <option value="clay">चिकनी मिट्टी | Clay Soil</option>
                            <option value="well-drained">अच्छी जल निकासी वाली मिट्टी | Well-drained Soil</option>
                            <option value="red">लाल मिट्टी | Red Soil</option>
                            <option value="clay-loamy">चिकनी दोमट मिट्टी | Clay Loamy Soil</option>
                            <option value="sandy-loamy">रेतीली दोमट मिट्टी | Sandy Loamy Soil</option>
                            <option value="black">काली मिट्टी | Black Soil</option>
                            <option value="sandy">रेतीली मिट्टी | Sandy Soil</option>
                            <option value="shallow-black">उथली काली मिट्टी | Shallow Black Soil</option>
                            <option value="black-cotton">काली कपास मिट्टी | Black Cotton Soil</option>
                            <option value="cotton">कपास मिट्टी | Cotton Soil</option>
                            <option value="medium-black">मध्यम काली मिट्टी | Medium Black Soil</option>
                            <option value="heavy-black">भारी काली मिट्टी | Heavy Black Soil</option>
                            <option value="light">हल्की मिट्टी | Light Soil</option>
                            <option value="heavy">भारी मिट्टी | Heavy Soil</option>
                            <option value="deep">गहरी मिट्टी | Deep Soil</option>
                            <option value="sandy-clay-loamy">रेतीली चिकनी दोमट मिट्टी | Sandy Clay Loamy Soil</option>
                            <option value="silty-loamy">मुलायम दोमट मिट्टी | Silty Loamy Soil</option>
                            <option value="salty-clay-loamy">नमकीन चिकनी दोमट मिट्टी | Salty Clay Loamy Soil</option>
                            <option value="red-loamy">लाल दोमट मिट्टी | Red Loamy Soil</option>
                            <option value="brown-loamy">भूरी दोमट मिट्टी | Brown Loamy Soil</option>
                            <option value="laterite">लेटराइट मिट्टी | Laterite Soil</option>
                            <option value="well-drained-loamy">अच्छी जल निकासी वाली दोमट मिट्टी | Well-drained Loamy Soil</option>
                            <option value="light-loamy">हल्की दोमट मिट्टी | Light Loamy Soil</option>
                            <option value="friable">भुरभुरी मिट्टी | Friable Soil</option>
                            <option value="well-grained-deep-loamy-moist">अच्छी दानेदार गहरी दोमट नम मिट्टी | Well-grained Deep Loamy Moist Soil</option>
                            <option value="red-lateritic-loamy">लाल लेटराइट दोमट मिट्टी | Red Lateritic Loamy Soil</option>
                            <option value="rich-red-loamy">समृद्ध लाल दोमट मिट्टी | Rich Red Loamy Soil</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sown" id="seasonLabel">
                            बुवाई का मौसम
                            <i class="fas fa-info-circle info-tooltip">
                                <span class="tooltip-text" id="seasonTooltip">आप कब बुवाई करना चाहते हैं?</span>
                            </i>
                        </label>
                        <select class="form-control" id="sown" required>
                            <option value="" id="seasonPlaceholder">मौसम चुनें</option>
                            <option value="kharif">खरीफ | Kharif (मानसून)</option>
                            <option value="rabi">रबी | Rabi (सर्दी)</option>
                            <option value="zaid">जायद | Zaid (गर्मी)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="soil_ph" id="phLabel">
                            मिट्टी का pH
                            <span class="bilingual">(6.0 - 8.5)</span>
                        </label>
                        <input type="number" class="form-control" id="soil_ph" min="4" max="10" step="0.1" placeholder="7.0" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="temp" id="tempLabel">
                                तापमान
                                <span class="bilingual">(°C)</span>
                            </label>
                            <input type="number" class="form-control" id="temp" min="-10" max="50" step="0.1" placeholder="25" required>
                        </div>
                        <div class="form-group">
                            <label for="humidity" id="humidityLabel">
                                आर्द्रता
                                <span class="bilingual">(%)</span>
                            </label>
                            <input type="number" class="form-control" id="humidity" min="0" max="100" step="1" placeholder="60" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="nitrogen" id="nitrogenLabel">
                                नाइट्रोजन (N)
                                <span class="bilingual">(kg/ha)</span>
                            </label>
                            <input type="number" class="form-control" id="nitrogen" min="0" max="300" step="1" placeholder="50" required>
                        </div>
                        <div class="form-group">
                            <label for="phosphorus" id="phosphorusLabel">
                                फास्फोरस (P)
                                <span class="bilingual">(kg/ha)</span>
                            </label>
                            <input type="number" class="form-control" id="phosphorus" min="0" max="150" step="1" placeholder="25" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="potassium" id="potassiumLabel">
                            पोटैशियम (K)
                            <span class="bilingual">(kg/ha)</span>
                        </label>
                        <input type="number" class="form-control" id="potassium" min="0" max="250" step="1" placeholder="30" required>
                    </div>

                    <button type="submit" class="predict-btn">
                        <i class="fas fa-magic"></i> <span id="predictBtn">फसल की भविष्यवाणी करें</span>
                    </button>
                    <!-- END FORM COPY -->
                </form>
            </div>

            <div class="output-section">
                <div id="resultsContainer" class="results-container">
                    <div class="empty-state">
                        <i class="fas fa-seedling"></i>
                        <p id="emptyStateText">कृपया विवरण भरें<br><span class="bilingual">Please fill the details to get crop predictions</span></p>
                    </div>
                </div>

                <div id="loadingState" class="loading" style="display:none;">
                    <div class="spinner"></div>
                    <p id="loadingText">भविष्यवाणी हो रही है...<br><span class="bilingual">Analyzing your data...</span></p>
                </div>
            </div>
        </div>
    </div>
    <!-- END ORIGINAL BODY -->

    <script>
        // --------- Localization (keep from your original) ----------
        let currentLang = 'hi';
        const translations = {
            hi: { langText: "English", mainTitle: "किसान मित्र - Crop Predictor", subtitle: "आपकी फसल की भविष्यवाणी करने वाला स्मार्ट सलाहकार", formTitle: "फसल की जानकारी दें", soilLabel: "मिट्टी का प्रकार", soilTooltip: "अपने खेत की मिट्टी का प्रकार चुनें", soilPlaceholder: "मिट्टी चुनें", seasonLabel: "बुवाई का मौसम", seasonTooltip: "आप कब बुवाई करना चाहते हैं?", seasonPlaceholder: "मौसम चुनें", phLabel: "मिट्टी का pH", tempLabel: "तापमान", humidityLabel: "आर्द्रता", nitrogenLabel: "नाइट्रोजन (N)", phosphorusLabel: "फास्फोरस (P)", potassiumLabel: "पोटैशियम (K)", predictBtn: "फसल की भविष्यवाणी करें", emptyStateText: "कृपया विवरण भरें<br><span class=\"bilingual\">Please fill the details to get crop predictions</span>", loadingText: "भविष्यवाणी हो रही है...<br><span class=\"bilingual\">Analyzing your data...</span>", recommendedCrop: "सुझावित फसल", waterSource: "पानी का स्रोत", cropDuration: "फसल की अवधि", waterRequired: "पानी की आवश्यकता", bestSuited: "आपकी मिट्टी के अनुकूल", optimalIrrigation: "बेहतर सिंचाई के लिए", sowingToHarvest: "बुवाई से कटाई तक", perKgProduction: "प्रति किलो उत्पादन" },
            en: { langText: "हिंदी", mainTitle: "Farmer Friend - Crop Predictor", subtitle: "Your Smart Agricultural Advisor for Crop Prediction", formTitle: "Enter Crop Details", soilLabel: "Soil Type", soilTooltip: "Select the type of soil in your field", soilPlaceholder: "Select Soil", seasonLabel: "Sowing Season", seasonTooltip: "When are you planning to sow?", seasonPlaceholder: "Select Season", phLabel: "Soil pH", tempLabel: "Temperature", humidityLabel: "Humidity", nitrogenLabel: "Nitrogen (N)", phosphorusLabel: "Phosphorus (P)", potassiumLabel: "Potassium (K)", predictBtn: "Predict Crop", emptyStateText: "Please fill the details to get crop predictions", loadingText: "Analyzing your data...", recommendedCrop: "Recommended Crop", waterSource: "Water Source", cropDuration: "Crop Duration", waterRequired: "Water Required", bestSuited: "Best suited for your soil", optimalIrrigation: "For optimal irrigation", sowingToHarvest: "From sowing to harvest", perKgProduction: "Per kg of production" }
        };

        function updateLanguage() {
            const lang = currentLang;
            document.getElementById('langText').textContent = translations[lang].langText;
            document.getElementById('mainTitle').textContent = translations[lang].mainTitle;
            document.getElementById('subtitle').textContent = translations[lang].subtitle;
            document.getElementById('formTitle').textContent = translations[lang].formTitle;
            document.getElementById('soilLabel').innerHTML = translations[lang].soilLabel + `
                <i class="fas fa-info-circle info-tooltip">
                    <span class="tooltip-text">${translations[lang].soilTooltip}</span>
                </i>`;
            document.getElementById('soilPlaceholder').textContent = translations[lang].soilPlaceholder;
            document.getElementById('seasonLabel').innerHTML = translations[lang].seasonLabel + `
                <i class="fas fa-info-circle info-tooltip">
                    <span class="tooltip-text">${translations[lang].seasonTooltip}</span>
                </i>`;
            document.getElementById('seasonPlaceholder').textContent = translations[lang].seasonPlaceholder;
            document.getElementById('phLabel').innerHTML = translations[lang].phLabel + '<span class="bilingual">(6.0 - 8.5)</span>';
            document.getElementById('tempLabel').innerHTML = translations[lang].tempLabel + '<span class="bilingual">(°C)</span>';
            document.getElementById('humidityLabel').innerHTML = translations[lang].humidityLabel + '<span class="bilingual">(%)</span>';
            document.getElementById('nitrogenLabel').innerHTML = translations[lang].nitrogenLabel + '<span class="bilingual">(kg/ha)</span>';
            document.getElementById('phosphorusLabel').innerHTML = translations[lang].phosphorusLabel + '<span class="bilingual">(kg/ha)</span>';
            document.getElementById('potassiumLabel').innerHTML = translations[lang].potassiumLabel + '<span class="bilingual">(kg/ha)</span>';
            document.getElementById('predictBtn').textContent = translations[lang].predictBtn;
            document.getElementById('emptyStateText').innerHTML = translations[lang].emptyStateText;
            document.getElementById('loadingText').innerHTML = translations[lang].loadingText;
        }

        document.getElementById('languageToggle').addEventListener('click', function() {
            currentLang = currentLang === 'hi' ? 'en' : 'hi';
            updateLanguage();
        });

        // --------- Backend call code: replace BACKEND_URL before deployment ----------
        const BACKEND_URL = "https://crop-sage-uj67.onrender.com"; // <-- replace with deployed backend URL (e.g. https://your-backend.onrender.com)

        function showLoading() {
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
        }
        function hideLoading() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
        }

        document.getElementById('cropForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading();

            const payload = {
                SOIL: document.getElementById('soil').value,
                SOWN: document.getElementById('sown').value,
                SOIL_PH: parseFloat(document.getElementById('soil_ph').value),
                TEMP: parseFloat(document.getElementById('temp').value),
                RELATIVE_HUMIDITY: parseFloat(document.getElementById('humidity').value),
                N: parseFloat(document.getElementById('nitrogen').value),
                P: parseFloat(document.getElementById('phosphorus').value),
                K: parseFloat(document.getElementById('potassium').value)
            };

            try {
                const res = await fetch(`${BACKEND_URL}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error('API error: ' + res.status);
                const data = await res.json();
                hideLoading();

                const lang = currentLang;
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="result-card">
                        <div class="result-title"><i class="fas fa-seedling"></i> ${translations[lang].recommendedCrop}</div>
                        <div class="result-value">${data.crop.label} (${(data.crop.confidence*100).toFixed(1)}%)</div>
                        <div class="result-subtitle">${translations[lang].bestSuited}</div>
                    </div>

                    <div class="result-card">
                        <div class="result-title"><i class="fas fa-tint"></i> ${translations[lang].waterSource}</div>
                        <div class="result-value">${data.water_source.label} (${(data.water_source.confidence*100).toFixed(1)}%)</div>
                        <div class="result-subtitle">${translations[lang].optimalIrrigation}</div>
                    </div>

                    <div class="result-card">
                        <div class="result-title"><i class="fas fa-calendar-alt"></i> ${translations[lang].cropDuration}</div>
                        <div class="result-value">${Math.round(data.crop_duration)} days</div>
                        <div class="result-subtitle">${translations[lang].sowingToHarvest}</div>
                    </div>

                    <div class="result-card">
                        <div class="result-title"><i class="fas fa-water"></i> ${translations[lang].waterRequired}</div>
                        <div class="result-value">${Math.round(data.water_required)} L/kg</div>
                        <div class="result-subtitle">${translations[lang].perKgProduction}</div>
                    </div>
                `;
            } catch (err) {
                hideLoading();
                document.getElementById('resultsContainer').innerHTML = `<div class="result-card"><div class="result-title">Error</div><div class="result-value">${err.message}</div></div>`;
            }
        });

        // small UI niceties
        const inputs = document.querySelectorAll('.form-control');
        inputs.forEach(input => {
            input.addEventListener('focus', function() { this.style.transform = 'scale(1.02)'; });
            input.addEventListener('blur', function() { this.style.transform = 'scale(1)'; });
        });

        updateLanguage();
    </script>
</body>
</html>
